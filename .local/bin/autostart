#!/bin/sh

# === Monitor setup (auto-detect connected) ===
monitors

# === Keyboard & Mouse ===
xset r rate 200 50
xset -b
xset s off -dpms

# === Numlock & Gestures ===
command -v numlockx >/dev/null 2>&1 && numlockx &
command -v libinput-gestures >/dev/null 2>&1 &&
  pkill -f .libinput-gestu >/dev/null || libinput-gestures &

# === Touchpad & TrackPoint (auto-detect) ===
for id in $(xinput list --id-only | xargs -n1 xinput list-props | grep -B1 "Touchpad\|TrackPoint" | grep "id=" | awk '{print $4}'); do
  name=$(xinput list "$id" | grep -o '".*"' | tr -d '"')
  if echo "$name" | grep -qi touchpad; then
    xinput set-prop "$id" "libinput Tapping Enabled" 1
    xinput set-prop "$id" "libinput Natural Scrolling Enabled" 0
    xinput set-prop "$id" "libinput Disable While Typing Enabled" 1
    xinput set-prop "$id" "libinput Accel Speed" 0.3
  elif echo "$name" | grep -qi trackpoint; then
    xinput set-prop "$id" "libinput Accel Speed" 0.0
  fi
done

# === Background apps (no duplicates) ===
for app in dunst picom sxhkd nm-applet blueman-applet; do
  pgrep -x "$app" >/dev/null || $app &
done

# === Wallpaper & Polybar ===
wal -R &

# === Cursor theme ===
if [ -f "$HOME/.local/share/icons/Bibata-Modern-Amber/cursors/left_ptr" ]; then
  xsetroot -cursor_name left_ptr
  xsetroot -xcf "$HOME/.local/share/icons/Bibata-Modern-Amber/cursors/left_ptr" 30
fi
